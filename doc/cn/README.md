XWay 设计

# 定位

一套完整的云原生网关解决方案。

# 原则

- 最简完备：只保留最必要的组件。

# 目标

- 高可用：除数据库组件外，所有组件都支持多副本。
    - 网关需把配置挂载出去，避免副本重启需要同步配置，导致服务不可用。

# 功能

- 配置版本控制
- 配置同步控制 —— 启停；指定分区、集群、节点；指定版本；自动发布；
- 灰度发布
- 插件 —— 参考 kong 和 apisix
- 自定义条件及动作（Lua 代码）
- 路由管理
- 用户管理
- 日志收集、展示
- 指标统计
- 静态资源管理
- DNS
- 多层网络
- 操作日志
- Let's Encrypt
- 主动健康检查——上游
- 被动心跳——自身组件
- 发布预览
- IPv6
- HTTP 2
- websocket
- 节点、集群、分区（？）、全局（？）缓存共享
- 升级完成后配置确认

# 抉择
- 保留插件及 Lua 相关的功能，放弃多租户；因为无法保证租户信息的安全性。
- 程序生成 ID，为日后数据库双写提供可能性

- 长时间灰度方案设计
    - 需求：灰度期间，生产配置允许改动。

# 其他
* 极致优化：https://openrestyinc.slack.com/archives/CS1P15GE5/p1634867378076900
* 更多需求参考：https://github.com/Kong/kong
* 信息上报、定期任务涉及数据库时，要分批次操作数据库，不能每次都操作数据库，避免出现数据库连接不够用等情况。
